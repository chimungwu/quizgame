<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>å…©ä½æ•¸ä¹˜æ³•é€Ÿç®—éŠæˆ²</title>
  <style>
    :root { --bg:#0f172a; --card:#111827; --txt:#e5e7eb; --accent:#38bdf8; --good:#22c55e; --bad:#ef4444; }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:linear-gradient(180deg,#0b1220,#0b1325 40%,#0b152a);
      color:var(--txt); display:flex; min-height:100vh; align-items:center; justify-content:center; padding:20px;
    }
    .wrap{width:min(920px,100%); display:grid; gap:16px}
    .card{
      background:rgba(17,24,39,.85); border:1px solid #1f2937; border-radius:20px; padding:20px; backdrop-filter:blur(6px);
      box-shadow:0 10px 30px rgba(0,0,0,.35);
    }
    h1{margin:0 0 6px; font-size:clamp(22px,3.5vw,32px)}
    .sub{opacity:.8; font-size:14px; margin-bottom:12px}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .pill{padding:8px 12px; border-radius:999px; background:#0b1220; border:1px solid #1f2937; font-size:14px}
    .pill b{color:var(--accent)}
    .question{
      font-size:clamp(28px,6vw,44px); text-align:center; padding:16px; border-radius:16px;
      background:#0b1220; border:1px solid #1f2937; letter-spacing:1px
    }
    .options{display:grid; grid-template-columns:repeat(2,1fr); gap:10px}
    button.option{
      padding:14px 10px; font-size:clamp(18px,3.5vw,22px); border-radius:14px; border:1px solid #374151;
      background:#0d1726; color:var(--txt); cursor:pointer; transition:.15s transform,.15s background,.15s border;
    }
    button.option:hover{transform:translateY(-1px); background:#0f1c30}
    button.option.correct{border-color:rgba(34,197,94,.7); background:rgba(34,197,94,.1)}
    button.option.wrong{border-color:rgba(239,68,68,.7); background:rgba(239,68,68,.08)}
    .controls{display:flex; gap:10px; flex-wrap:wrap; justify-content:center}
    .btn{
      padding:10px 14px; border-radius:12px; border:1px solid #374151; background:#0d1726; color:var(--txt);
      cursor:pointer; font-size:16px
    }
    .btn.primary{border-color:var(--accent); background:rgba(56,189,248,.1)}
    .btn.danger{border-color:#ef4444; background:rgba(239,68,68,.1)}
    .tip{
      font-size:14px; border-left:3px solid var(--accent); padding:10px 12px; background:#0b1220; border-radius:8px; opacity:.95
    }
    .scoreboard{display:flex; gap:10px; justify-content:space-between; flex-wrap:wrap}
    .muted{opacity:.7}
    .big{font-size:clamp(20px,3.5vw,26px)}
    .hidden{display:none}
    footer{opacity:.6; font-size:12px; text-align:center}
  </style>
</head>
<body>
  <main class="wrap">
    <section class="card">
      <h1>ğŸ® 100 ä»¥å…§å…©ä½æ•¸ä¹˜æ³•é€Ÿç®—éŠæˆ²</h1>
      <div class="sub">åŒ…å«ï¼šæ‹†åˆ†æ³•ã€é è¿‘æ•´åã€å¹³æ–¹å·®ã€æ¥è¿‘ 100ã€å°¾æ•¸äº’è£œã€å°¾æ•¸ 5ã€å€æ•¸/ä¸€åŠã€å¹³æ–¹</div>
      <div class="scoreboard">
        <div class="row">
          <div class="pill">æ¨¡å¼ï¼š<b id="modeLabel">ç·´ç¿’</b></div>
          <div class="pill">åˆ†æ•¸ï¼š<b id="score">0</b></div>
          <div class="pill">å‰©é¤˜æ™‚é–“ï¼š<b id="time">â€”</b></div>
          <div class="pill">é€£çºŒç­”å°ï¼š<b id="streak">0</b></div>
        </div>
        <div class="row controls">
          <button class="btn" id="btnPractice">ç·´ç¿’æ¨¡å¼</button>
          <button class="btn primary" id="btnChallenge">30 ç§’æŒ‘æˆ°</button>
          <button class="btn" id="btnNext">ä¸‹ä¸€é¡Œ</button>
          <button class="btn danger" id="btnReset">é‡ç½®</button>
        </div>
      </div>
    </section>

    <section class="card">
      <div id="question" class="question">æŒ‰ã€Œç·´ç¿’æ¨¡å¼ã€æˆ–ã€Œ30 ç§’æŒ‘æˆ°ã€é–‹å§‹</div>
      <div id="options" class="options"></div>
    </section>

    <section class="card">
      <div class="tip" id="tip">æç¤ºæœƒé¡¯ç¤ºåœ¨é€™è£¡ï¼ˆç­”éŒ¯æˆ–æŒ‰ä¸‹ä¸€é¡Œå¾Œå‡ºç¾ï¼‰ã€‚</div>
    </section>

    <footer>ç­”å° +10 åˆ†ï¼Œç­”éŒ¯ âˆ’5 åˆ†ï¼›æŒ‘æˆ°æ¨¡å¼ 30 ç§’å…§ç›¡é‡ä½œç­”ã€‚</footer>
  </main>

  <script>
    // ç‹€æ…‹
    let mode = 'practice';           // 'practice' | 'challenge'
    let score = 0;
    let streak = 0;
    let timeLeft = null;             // ç§’
    let timerId = null;
    let current = null;              // {a,b,ans,tip}
    let locked = false;              // é˜²æ­¢é‡è¤‡é»æ“Š

    // DOM
    const modeLabel = document.getElementById('modeLabel');
    const scoreEl = document.getElementById('score');
    const timeEl = document.getElementById('time');
    const streakEl = document.getElementById('streak');
    const qEl = document.getElementById('question');
    const optsEl = document.getElementById('options');
    const tipEl = document.getElementById('tip');
    const btnPractice = document.getElementById('btnPractice');
    const btnChallenge = document.getElementById('btnChallenge');
    const btnNext = document.getElementById('btnNext');
    const btnReset = document.getElementById('btnReset');

    // äº‹ä»¶
    btnPractice.addEventListener('click', () => startPractice());
    btnChallenge.addEventListener('click', () => startChallenge());
    btnNext.addEventListener('click', () => { if(!locked) newQuestion(); });
    btnReset.addEventListener('click', resetAll);

    // å·¥å…·ï¼šç”Ÿæˆé¡Œç›® + æŠ€å·§æç¤º
    function generateQuestion(){
      const a = randInt(10,99);
      const b = randInt(10,99);
      const ans = a*b;
      const tip = decideTip(a,b);
      return {a,b,ans,tip};
    }
    function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }

    function decideTip(a,b){
      // å°¾æ•¸æ˜¯ 5 çš„å¹³æ–¹
      if(a===b && a%10===5){
        const head = Math.floor(a/10);
        return `å°¾æ•¸ 5ï¼š${head}Ã—(${head}+1)=${head*(head+1)}ï½œå°¾å·´ 25 â†’ ${a}Ã—${a}`;
      }
      // å¹³æ–¹ (aÂ±b)^2
      if(a===b){
        const t = Math.round(a/10)*10;
        const d = Math.abs(a - t);
        return `å¹³æ–¹ï¼š( ${t}Â±${d} )Â² = ${t}Â² Â± 2Ã—${t}Ã—${d} + ${d}Â²`;
      }
      // å°¾æ•¸äº’è£œï¼ˆåä½ç›¸åŒã€å€‹ä½äº’è£œ 10ï¼‰
      if(Math.floor(a/10)===Math.floor(b/10) && (a%10 + b%10===10)){
        const t = Math.floor(a/10);
        const u = a%10, v = b%10;
        return `å°¾æ•¸äº’è£œï¼š${t}Ã—(${t}+1)ï½œ${u}Ã—${v} â†’ å‰é¢ ${t*(t+1)}ï½œå¾Œé¢ ${u*v}`;
      }
      // æ¥è¿‘ 100
      if(a>=90 && b>=90){
        const da = 100 - a, db = 100 - b;
        return `æ¥è¿‘ 100ï¼šå‰é¢ 100âˆ’(${da}+${db})ï½œå¾Œé¢ ${da}Ã—${db}ï¼ˆå…©ä½æ•¸è£œé›¶ï¼‰`;
      }
      // å¹³æ–¹å·® (mâˆ’n)(m+n)=mÂ²âˆ’nÂ²
      if( Math.abs(a-b)===2 && ((a+b)%2===0) ){
        const m = (a+b)/2, n = Math.abs(a-b)/2;
        return `å¹³æ–¹å·®ï¼š( ${m}âˆ’${n} )( ${m}+${n} ) = ${m}Â² âˆ’ ${n}Â²`;
      }
      // å€æ•¸/ä¸€åŠ
      if(a%25===0 || b%25===0 || a%50===0 || b%50===0 || a%b===0 || b%a===0){
        return `å€æ•¸ï¼ä¸€åŠï¼šå…ˆæŠŠ 25 ç•¶ 100Ã·4ã€50 ç•¶ 100Ã·2ï¼Œæˆ–å…ˆåšå¯æ•´é™¤çš„ä¹˜é™¤å†è¨ˆç®—ã€‚`;
      }
      // æ‹†åˆ†æ³• fallback
      const aT=Math.floor(a/10), aU=a%10, bT=Math.floor(b/10), bU=b%10;
      return `æ‹†åˆ†æ³•ï¼š(${aT}0+${aU})Ã—(${bT}0+${bU}) â†’ åä½Ã—åä½ + åä½Ã—å€‹ä½â€¦`;
    }

    // ç”Ÿæˆé¸é …ï¼ˆå«æ­£è§£ + å¹²æ“¾é …ï¼‰
    function buildOptions(ans){
      const s = new Set([ans]);
      // 1) è¿‘ä¼¼å€¼
      while(s.size<2){ s.add(ans + randInt(-25,25)); }
      // 2) å››æ¨äº”å…¥éŒ¯èª¤
      const rounded = Math.round(ans/10)*10;
      if(rounded>0) s.add(rounded);
      // 3) ä½ç§»éŒ¯èª¤ï¼ˆå°‘ä¸€å€‹ 0 æˆ–å¤šä¸€å€‹ 0ï¼Œä½†é™åˆ¶åœ¨ç¯„åœå…§ï¼‰
      if(ans>99) s.add(ans - (ans%10||10));
      // 4) ä¹˜æ•¸åå·®
      s.add(ans + (10*(randInt(-2,2))));
      // æ¸…æ´—
      let arr = Array.from(s).filter(x=>x>0);
      // è£œè¶³åˆ° 4 å€‹
      while(arr.length<4){
        const w = ans + randInt(-40,40);
        if(w>0 && !arr.includes(w)) arr.push(w);
      }
      // åªå– 4 å€‹
      arr = arr.slice(0,4);
      // æ´—ç‰Œ
      return arr.sort(()=>Math.random()-0.5);
    }

    // å‡ºé¡Œ
    function newQuestion(){
      locked = false;
      current = generateQuestion();
      qEl.textContent = `${current.a} Ã— ${current.b} = ?`;
      tipEl.textContent = 'æç¤ºï¼šå…ˆè‡ªå·±è©¦è©¦çœ‹ï¼Œç­”éŒ¯æœƒé¡¯ç¤ºè§£æ³•ã€‚';
      renderOptions();
    }

    function renderOptions(){
      const ops = buildOptions(current.ans);
      optsEl.innerHTML = '';
      ops.forEach(val=>{
        const btn = document.createElement('button');
        btn.className = 'option';
        btn.textContent = val;
        btn.addEventListener('click', ()=> choose(val, btn));
        optsEl.appendChild(btn);
      });
    }

    // ä½œç­”
    function choose(val, btn){
      if(locked) return;
      locked = true;
      const all = Array.from(document.querySelectorAll('button.option'));
      const correctBtn = all.find(b => Number(b.textContent) === current.ans);
      if(val === current.ans){
        btn.classList.add('correct');
        score += 10;
        streak += 1;
        tipEl.innerHTML = `âœ… ç­”å°ï¼<span class="muted">+10 åˆ†</span>${streak>=3?`ã€€ğŸ”¥ é€£å° ${streak} é¡Œï¼`:''}`;
      }else{
        btn.classList.add('wrong');
        if(correctBtn) correctBtn.classList.add('correct');
        score -= 5;
        streak = 0;
        tipEl.innerHTML = `âŒ ç­”éŒ¯ï¼<br>è§£é¡Œæç¤ºï¼š${current.tip}ã€€<span class="muted">ï¼ˆâˆ’5 åˆ†ï¼‰</span>`;
      }
      updateUI();

      // æŒ‘æˆ°æ¨¡å¼è‡ªå‹•æ›é¡Œï¼›ç·´ç¿’æ¨¡å¼ 1.2 ç§’å¾Œè‡ªå‹•ä¸‹ä¸€é¡Œï¼ˆä¹Ÿå¯æŒ‰ã€Œä¸‹ä¸€é¡Œã€ï¼‰
      if(mode==='challenge'){
        setTimeout(()=>{ if(timeLeft>0) newQuestion(); }, 600);
      }else{
        setTimeout(()=>{ locked=false; }, 200);
      }
    }

    // æ¨¡å¼
    function startPractice(){
      stopTimer();
      mode='practice'; modeLabel.textContent='ç·´ç¿’';
      timeLeft = null; timeEl.textContent='â€”';
      score = 0; streak = 0; updateUI();
      newQuestion();
    }

    function startChallenge(){
      mode='challenge'; modeLabel.textContent='æŒ‘æˆ°ï¼ˆ30 ç§’ï¼‰';
      score = 0; streak = 0; updateUI();
      timeLeft = 30; timeEl.textContent = timeLeft+'s';
      newQuestion();
      stopTimer();
      timerId = setInterval(()=>{
        timeLeft--;
        timeEl.textContent = timeLeft+'s';
        if(timeLeft<=0){
          stopTimer();
          lockAll();
          qEl.textContent = `æ™‚é–“åˆ°ï¼ä½ çš„åˆ†æ•¸ï¼š${score}`;
          tipEl.innerHTML = `ğŸ”” å»ºè­°å¤šç·´ï¼šè‹¥å¸¸çœ‹åˆ°ã€Œæ‹†åˆ†æ³•ã€æç¤ºï¼Œä»£è¡¨å…ˆç·´åŸºç¤å±•é–‹ï¼›è‹¥å¸¸å‡ºç¾ã€Œæ¥è¿‘ 100ã€æˆ–ã€Œå¹³æ–¹å·®ã€ï¼Œä¸‹æ¬¡é‡åˆ°é è¿‘æ•´å/æ•´ç™¾å°±è¦æƒ³åˆ°ã€‚`;
        }
      },1000);
    }

    function lockAll(){
      locked = true;
      document.querySelectorAll('button.option').forEach(b=>b.disabled=true);
    }

    function stopTimer(){
      if(timerId){ clearInterval(timerId); timerId=null; }
    }

    function resetAll(){
      stopTimer();
      mode='practice'; modeLabel.textContent='ç·´ç¿’';
      score=0; streak=0; timeLeft=null;
      updateUI();
      qEl.textContent = 'æŒ‰ã€Œç·´ç¿’æ¨¡å¼ã€æˆ–ã€Œ30 ç§’æŒ‘æˆ°ã€é–‹å§‹';
      optsEl.innerHTML = '';
      tipEl.textContent = 'æç¤ºæœƒé¡¯ç¤ºåœ¨é€™è£¡ï¼ˆç­”éŒ¯æˆ–æŒ‰ä¸‹ä¸€é¡Œå¾Œå‡ºç¾ï¼‰ã€‚';
    }

    function updateUI(){
      scoreEl.textContent = score;
      streakEl.textContent = streak;
      if(timeLeft===null) timeEl.textContent='â€”';
    }

    // é è¨­è¼‰å…¥ç·´ç¿’æ¨¡å¼
    // startPractice();
  </script>
</body>
</html>
