<!doctype html>
<html lang="zh-Hant">
<head>
  <!-- æ›¸ç±¤/åˆ†é  icon -->
<link rel="icon" type="image/png" href="favicon2.PNG" />
<!-- iPhone/iPad ä¸»ç•«é¢ icon -->
<link rel="apple-touch-icon" href="favicon2.PNG" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å¿ƒç®—æŠ€å·§ç·´ç¿’ï¼ˆå«è‡ªå‹•è©³è§£ï¼‰</title>
  <style>
    :root{
      --bg:#e6f2ff; --card:#ffffff; --ink:#0f172a; --muted:#475569; --accent:#2563eb;
      --ok:#16a34a; --err:#dc2626; --warn:#f59e0b; --radius:16px;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui,-apple-system,"Noto Sans TC",Segoe UI,Roboto,Arial,sans-serif; background:var(--bg); color:var(--ink)}
    .wrap{max-width:1000px;margin:auto; padding:20px}
    header{display:flex;gap:12px;align-items:flex-start;justify-content:space-between;flex-wrap:wrap}
    h1{font-size:clamp(28px,4vw,40px);margin:0;line-height:1.2}
    .sub{color:var(--muted); font-size:14px}

    .panel{margin-top:12px; background:var(--card); border:1px solid #e2e8f0; border-radius:var(--radius); padding:14px}
    .controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .group{display:flex;align-items:center;gap:6px; background:#f8fafc; border:1px solid #e2e8f0; padding:8px 10px; border-radius:12px}
    label{color:#334155;font-size:14px}
    select,input[type=number]{padding:8px 10px; border:1px solid #cbd5e1; border-radius:10px; background:#fff; min-width:80px}
    button{appearance:none;border:0;border-radius:999px; padding:10px 16px; background:var(--accent); color:#fff; font-weight:600; cursor:pointer}
    button.ghost{background:transparent;color:#334155;border:1px solid #cbd5e1}

    .grid{display:grid; grid-template-columns:repeat(1,minmax(0,1fr)); gap:12px}
    @media(min-width:700px){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media(min-width:1000px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}

    .card{background:#fff;border:1px solid #e2e8f0;border-radius:14px;padding:12px; box-shadow:0 1px 0 #f3f4f6}
    .q-title{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:8px}
    .badge{font-size:12px;color:#64748b;border:1px solid #e2e8f0;border-radius:999px;padding:2px 8px}
    .expr{font-size:22px; font-weight:800; letter-spacing:.3px}
    .ans{margin-top:8px; display:flex; gap:8px; align-items:center}
    .ans input{flex:1; padding:10px 12px; border:1px solid #cbd5e1; border-radius:10px}
    .flag{font-size:12px;color:#64748b}
    .flag.ok{color:var(--ok)}
    .flag.err{color:var(--err)}

    .explain{margin-top:8px; font-size:14px; line-height:1.5; background:#f8fafc; border:1px dashed #cbd5e1; padding:10px; border-radius:10px}
    .explain code{background:#e2e8f0; padding:0 4px; border-radius:6px}

    .meter{height:10px;background:#eef2ff;border-radius:999px;overflow:hidden}
    .meter i{display:block;height:100%;width:0;background:linear-gradient(90deg,#22c55e,#4ade80)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>å¿ƒç®—æŠ€å·§ç·´ç¿’ï¼ˆå«è‡ªå‹•è©³è§£ï¼‰</h1>
        <div class="sub">é¸æ“‡ç‰¹å®šå¿ƒç®—æ³•å‡ºé¡Œï¼Œä½œç­”å¾Œæœƒè‡ªå‹•é¡¯ç¤ºã€Œæ­¥é©Ÿè©³è§£ã€ã€‚é©åˆåœ‹å°ï½åœ‹ä¸­è¨“ç·´æ•¸æ„Ÿèˆ‡è¦å¾‹ã€‚</div>
        <div class="sub">ğŸ’» ç¨‹å¼è¨­è¨ˆï¼š<a href="https://drwu.carrd.co" target="_blank">ä»¨å¯¶çˆ¸ä¸­é†«åšå£«å³å•“éŠ˜</a></div>
      </div>
    </header>

    <section class="panel">
      <div class="controls" role="group" aria-label="è¨­å®š">
        <div class="group">
          <label for="trick">æŠ€å·§</label>
          <select id="trick">
            <option value="tail5sq">å°¾æ•¸ 5 çš„å¹³æ–¹</option>
            <option value="sameTenSum10">åä½åŒã€å€‹ä½å’Œ 10</option>
            <option value="times11">å…©ä½æ•¸ Ã— 11</option>
            <option value="near100">æ¥è¿‘ 100 çš„ä¹˜æ³•</option>
            <option value="diffSq">å·®å¹³æ–¹ (a+b)(a-b)</option>
            <option value="nearTensSq">é è¿‘æ•´åçš„å¹³æ–¹</option>
            <option value="times5">ä¹˜ä»¥ 5</option>
            <option value="div5">é™¤ä»¥ 5</option>
            <option value="percent">ç™¾åˆ†æ¯”é€Ÿç®—</option>
          </select>
        </div>
        <div class="group">
          <label for="count">é¡Œæ•¸</label>
          <select id="count">
            <option>5</option>
            <option selected>10</option>
            <option>15</option>
            <option>20</option>
          </select>
        </div>
        <button id="btnStart">é–‹å§‹å‡ºé¡Œ</button>
      </div>
      <div class="sub" style="margin-top:6px">æ‰‹æ©Ÿä½œç­”å»ºè­°ï¼šè¼¸å…¥æ¡†æ”¯æ´æ•¸å­—éµç›¤ï¼ˆå¯è¼¸å…¥å°æ•¸ï¼‰ã€‚æŒ‰ Enter æœƒè·³åˆ°ä¸‹ä¸€é¡Œã€‚</div>
    </section>

    <section class="panel">
      <div id="quiz" class="grid" aria-live="polite"></div>
      <div style="margin-top:12px; display:flex; align-items:center; gap:10px; flex-wrap:wrap">
        <strong id="scoreText">å°šæœªäº¤å·</strong>
        <span class="badge" id="progress">0 / 0 å·²ä½œç­”</span>
        <div class="meter" style="flex:1; min-width:200px"><i id="meter"></i></div>
      </div>
      <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap">
        <button id="btnSubmit" class="ghost">äº¤å·æ‰¹æ”¹ï¼ˆä¸¦é¡¯ç¤ºè©³è§£ï¼‰</button>
        <button id="btnReveal" class="ghost">é¡¯ç¤ºç­”æ¡ˆèˆ‡è©³è§£</button>
        <button id="btnRestart" class="ghost">é‡æ–°å‡ºé¡Œ</button>
      </div>
    </section>
  </div>

  <script>
    // ========= å°å·¥å…· =========
    const $ = sel => document.querySelector(sel);
    const $$ = sel => [...document.querySelectorAll(sel)];
    const clamp=(n,min,max)=>Math.min(max,Math.max(min,n));
    const randInt=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
    const pad2=n=>String(n).padStart(2,'0');

    // ========= é¡Œåº«ï¼šå„æŠ€å·§çš„é¡Œç›®ç”Ÿæˆ & è©³è§£ =========
    // æ¯å€‹ç”Ÿæˆå™¨å›å‚³ï¼š{ text, answer, explainHTML, key }

    function gen_tail5sq(){
      const n = randInt(1,9); // åä½ n
      const x = 10*n + 5;
      const ans = x*x; // ä¹Ÿå¯ç”¨ n(n+1)|25
      const left = n*(n+1);
      const key = `tail5sq:${x}`;
      const explain = `å€‹ä½ç‚º 5 çš„å¹³æ–¹ï¼š<br>åä½æ•¸ä¹˜ä»¥ä¸‹ä¸€å€‹æ•¸ â†’ <code>${n}Ã—${n+1}=${left}</code>ï¼Œå¾Œå…©ä½å›ºå®š <code>25</code>ã€‚<br>æ‰€ä»¥ <code>${x}^2 = ${left}</code><code>25</code> â†’ <strong>${ans}</strong>`;
      return {text:`${x} çš„å¹³æ–¹ =`, answer:ans, explainHTML:explain, key};
    }

    function gen_sameTenSum10(){
      const a = randInt(1,9); // åä½
      const b = randInt(1,9); // å€‹ä½
      const b2 = 10-b; // å¦ä¸€å€‹å€‹ä½
      const x = 10*a + b;
      const y = 10*a + b2;
      const ans = x*y;
      const left = a*(a+1);
      const right = b*b2;
      const rightStr = pad2(right);
      const key = `sameTenSum10:${x}x${y}`;
      const explain = `åä½ç›¸åŒã€å€‹ä½å’Œç‚º 10ï¼š<br>å‰åŠ <code>${a}Ã—${a+1}=${left}</code>ï¼Œå¾ŒåŠ <code>${b}Ã—${b2}=${rightStr}</code>ï¼ˆå…©ä½æ•¸ï¼‰ã€‚<br>æ‰€ä»¥ <code>${x}Ã—${y} = ${left}</code><code>${rightStr}</code> â†’ <strong>${ans}</strong>`;
      return {text:`${x} Ã— ${y} =`, answer:ans, explainHTML:explain, key};
    }

    function gen_times11(){
      const a = randInt(1,9), b = randInt(0,9);
      const x = 10*a + b;
      const mid = a+b; // å¯èƒ½ >=10
      const ans = x*11;
      // é€²ä½è™•ç†èªªæ˜
      let explain;
      if(mid<10){
        explain = `å…©ä½æ•¸ Ã— 11ï¼šæŠŠä½å’Œæ”¾ä¸­é–“ï¼š<br><code>${a}${b}Ã—11 â†’ ${a}(${a}+${b})${b} = ${a}${mid}${b}</code> â†’ <strong>${ans}</strong>`;
      }else{
        const carry = 1, mid2 = mid-10;
        explain = `å…©ä½æ•¸ Ã— 11ï¼šå…ˆæ±‚ä½å’Œ <code>${a}+${b}=${mid}</code>ï¼Œä¸­é–“æ˜¯å…©ä½è¦é€²ä½ï¼š<br>`+
                  `<code>${a}${b}Ã—11 â†’ ${a}</code><code>${mid}</code><code>${b} â†’ (${a}+1)${mid2}${b} = </code><strong>${ans}</strong>`;
      }
      const key = `times11:${x}`;
      return {text:`${x} Ã— 11 =`, answer:ans, explainHTML:explain, key};
    }

    function gen_near100(){
      const a = randInt(1,20), b = randInt(1,20); // å·®å€¼
      const x = 100 - a, y = 100 - b;
      const ans = x*y;
      const front = 100 - (a+b);
      const back = a*b;
      let explain = `æ¥è¿‘ 100 ä¹˜æ³•ï¼š<br>å·®å€¼ <code>${a}</code> èˆ‡ <code>${b}</code>ï¼Œå‰åŠ <code>100-(${a}+${b})=${front}</code>ï¼›å¾ŒåŠ <code>${a}Ã—${b}=${back}</code>ã€‚`;
      if(back<100){
        explain += `<br>å¾ŒåŠè£œæˆå…©ä½ï¼š<code>${pad2(back)}</code>ã€‚<br>æ‰€ä»¥ <code>${x}Ã—${y} = ${front}</code><code>${pad2(back)}</code> â†’ <strong>${ans}</strong>`;
      }else{
        const carry = Math.floor(back/100), tail = String(back%100).padStart(2,'0');
        explain += `<br>å¾ŒåŠè¶…éå…©ä½ â†’ é€²ä½ <code>+${carry}</code> åˆ°å‰åŠï¼Œå°¾ç¢¼ <code>${tail}</code>ã€‚`+
                   `<br><code>${front}+${carry}=${front+carry}</code>ï¼Œç­”æ¡ˆ <strong>${front+carry}${tail} = ${ans}</strong>`;
      }
      const key = `near100:${x}x${y}`;
      return {text:`${x} Ã— ${y} =`, answer:ans, explainHTML:explain, key};
    }

    function gen_diffSq(){
      const a = randInt(20,120);
      const d = randInt(1,9);
      const x = a+d, y = a-d; // (a+d)(a-d)
      const ans = x*y; // = a^2 - d^2
      const explain = `å·®å¹³æ–¹å…¬å¼ï¼š<code>(a+b)(a-b)=a^2-b^2</code><br>`+
                      `è¨­ <code>a=${a}, b=${d}</code> â†’ <code>${x}Ã—${y} = ${a}^2 - ${d}^2 = ${a*a} - ${d*d} = </code><strong>${ans}</strong>`;
      const key = `diffSq:${x}x${y}`;
      return {text:`${x} Ã— ${y} =`, answer:ans, explainHTML:explain, key};
    }

    function gen_nearTensSq(){
      // éš¨æ©ŸæŒ‘ä¸€å€‹æ•´å tï¼Œè·é›¢ dï¼ˆ1~9ï¼‰
      const t = randInt(2,19)*10;
      const d = randInt(1,9);
      const n = Math.random()<0.5 ? (t-d) : (t+d);
      const ans = n*n;
      const explain = `é è¿‘æ•´åå¹³æ–¹ï¼š<code>n^2 = (t-d)(t+d) + d^2</code><br>`+
                      `é¸ <code>t=${t}</code>ï¼Œå·® <code>d=${Math.abs(n-t)}</code> â†’ <code>(${t}-${Math.abs(n-t)})(${t}+${Math.abs(n-t)}) + ${Math.abs(n-t)}^2</code><br>`+
                      `= <code>${(t-Math.abs(n-t))}Ã—${(t+Math.abs(n-t))} + ${Math.abs(n-t)**2}</code> â†’ <strong>${ans}</strong>`;
      const key = `nearTensSq:${n}`;
      return {text:`${n} çš„å¹³æ–¹ =`, answer:ans, explainHTML:explain, key};
    }

    function gen_times5(){
      const n = randInt(12,999);
      const ans = n*5;
      const explain = `ä¹˜ä»¥ 5ï¼šå…ˆ Ã—10 å† Ã·2ã€‚<br><code>${n}Ã—5 = (${n}Ã—10)Ã·2 = ${n}0 Ã· 2 = </code><strong>${ans}</strong>`;
      const key = `times5:${n}`;
      return {text:`${n} Ã— 5 =`, answer:ans, explainHTML:explain, key};
    }

    function gen_div5(){
      const n = randInt(50,9999);
      const ans = n/5;
      const explain = `é™¤ä»¥ 5ï¼šç­‰æ–¼ Ã—2 å† Ã·10ã€‚<br><code>${n}Ã·5 = (${n}Ã—2)Ã·10 = ${n*2} Ã· 10 = </code><strong>${ans}</strong>`;
      const key = `div5:${n}`;
      return {text:`${n} Ã· 5 =`, answer:ans, explainHTML:explain, key};
    }

    function gen_percent(){
      // å¾å¸¸è¦‹é›†åˆæŒ‘ç™¾åˆ†æ¯”
      const PSET = [6, 4.5, 1.1, 12.5, 15, 25, 40, 0.5, 2.5, 7.5];
      const p = PSET[randInt(0,PSET.length-1)];
      const base = randInt(80,5000);
      const ans = +(base * p / 100).toFixed(2);
      // è©³è§£ï¼šä»¥ 1% ç‚ºåŸºåº•æ‹†åˆ†
      const one = base/100;
      // æ‹† p ç‚ºæ•´æ•¸ + 0.5 + 0.25 ç­‰ï¼ˆåšå€‹ç°¡å–®æ‹†æ³•ï¼‰
      let parts=[]; let remain=p;
      const take=(v,label)=>{parts.push({label,value: +(one*v).toFixed(2)}); remain=+(remain - v).toFixed(2)};
      if(remain>=25 && remain%25===0){ take(25,'25%'); }
      while(remain>=10){ take(10,'10%'); }
      if(remain>=5){ take(5,'5%'); }
      if(remain>=2.5){ take(2.5,'2.5%'); }
      if(remain>=1){ const k=Math.floor(remain); take(k,`${k}%`); }
      if(remain>=0.5){ take(0.5,'0.5%'); }
      if(remain>0){ take(remain,`${remain}%`); }
      const lines = parts.map(x=>`<li>${x.label}ï¼š<code>${x.value}</code></li>`).join('');
      const sum = parts.reduce((s,x)=>s+x.value,0).toFixed(2);
      const explain = `ç™¾åˆ†æ¯”é€Ÿç®—ï¼šå…ˆæ±‚ 1% = <code>${one}</code>ï¼Œå†åŠ ç¸½éœ€è¦çš„éƒ¨åˆ†ï¼š<ul>${lines}</ul>`+
                      `åˆè¨ˆ = <code>${sum}</code> â†’ <strong>${ans}</strong>`;
      const key = `percent:${p}of${base}`;
      return {text:`${base} çš„ ${p}% =`, answer:ans, explainHTML:explain, key};
    }

    const generators = {
      tail5sq: gen_tail5sq,
      sameTenSum10: gen_sameTenSum10,
      times11: gen_times11,
      near100: gen_near100,
      diffSq: gen_diffSq,
      nearTensSq: gen_nearTensSq,
      times5: gen_times5,
      div5: gen_div5,
      percent: gen_percent,
    };

    // ========= å‡ºé¡Œèˆ‡äº’å‹• =========
    let currentQs=[];

    function makeQuiz(kind,count){
      const seen = new Set();
      const qs=[]; let tries=0; const LIMIT=count*100;
      while(qs.length<count && tries<LIMIT){
        tries++;
        const q = generators[kind]();
        if(seen.has(q.key)) continue;
        seen.add(q.key);
        qs.push(q);
      }
      return qs;
    }

    function renderQuiz(qs){
      const host=$('#quiz'); host.innerHTML='';
      qs.forEach((q,idx)=>{
        const card=document.createElement('div'); card.className='card';
        card.innerHTML=`
          <div class="q-title"><span class="badge">ç¬¬ ${idx+1} é¡Œ</span><span class="badge" data-role="flag"></span></div>
          <div class="expr">${q.text}</div>
          <div class="ans">
            <input type="text" inputmode="decimal" placeholder="è¼¸å…¥ç­”æ¡ˆ" data-idx="${idx}" />
            <button class="ghost" data-act="check" data-idx="${idx}">æª¢æŸ¥</button>
          </div>
          <div class="explain" data-role="explain" hidden></div>`;
        host.appendChild(card);
      });
      host.onclick=onCardClick; host.onkeydown=onKeyEnterNext; updateProgress();
    }

    function updateProgress(){
      const total=currentQs.length; const filled=$$('#quiz input').filter(i=>i.value.trim()!=='').length;
      $('#progress').textContent=`${filled} / ${total} å·²ä½œç­”`;
    }

    function onCardClick(e){
      const btn=e.target.closest('button[data-act="check"]');
      if(!btn) return; const idx=+btn.dataset.idx; checkOne(idx);
    }

    function onKeyEnterNext(e){
      if(e.key!=='Enter')return; const inp=e.target.closest('input'); if(!inp) return; e.preventDefault();
      const idx=+inp.dataset.idx; if(inp.value.trim()!=='') checkOne(idx,true);
      const next=$(`#quiz input[data-idx="${idx+1}"]`); if(next) next.focus(); else $('#btnSubmit').focus();
      updateProgress();
    }

    function showExplain(idx){
      const card=$$('#quiz .card')[idx]; if(!card) return;
      const box=card.querySelector('[data-role="explain"]');
      if(!box) return; box.innerHTML=currentQs[idx].explainHTML; box.hidden=false;
    }

    function checkOne(idx,silent=false){
      const card=$$('#quiz .card')[idx]; const flag=card.querySelector('[data-role="flag"]');
      const val=card.querySelector('input').value.trim();
      if(val===''){ if(!silent){flag.textContent='æœªä½œç­”'; flag.className='badge';} return false; }
      const ok = Math.abs(Number(val) - Number(currentQs[idx].answer)) < 1e-9;
      flag.textContent = ok ? 'âœ” æ­£ç¢º' : 'âœ˜ éŒ¯èª¤';
      flag.className='badge '+(ok?'flag ok':'flag err');
      // é¡¯ç¤ºè©³è§£ï¼ˆç¬¦åˆä½ çš„éœ€æ±‚ï¼šçµ¦ç­”æ¡ˆæ™‚è‡ªå‹•å‡ºç¾ï¼‰
      showExplain(idx);
      return ok;
    }

    function submitAll(){
      let score=0; currentQs.forEach((_,i)=>{ if(checkOne(i,true)) score++; else showExplain(i); });
      const total=currentQs.length; const pct=Math.round(score/total*100);
      $('#scoreText').textContent=`æˆç¸¾ï¼š${score} / ${total}ï¼ˆ${pct}%ï¼‰`;
      $('#meter').style.width=pct+'%';
      // é¡¯ç¤ºå…¨éƒ¨è©³è§£
      currentQs.forEach((_,i)=>showExplain(i));
    }

    function revealAll(){
      // æŠŠæ­£ç¢ºç­”æ¡ˆå¡«åœ¨ placeholderï¼Œä¸¦é¡¯ç¤ºè©³è§£ï¼›ä¸è¦†è“‹ä½œç­”
      $$('#quiz .card').forEach((card,i)=>{
        const inp=card.querySelector('input');
        if(inp && inp.value.trim()==='') inp.placeholder = currentQs[i].answer;
        showExplain(i);
      });
    }

    // ========= äº‹ä»¶ =========
    function start(){
      const kind = $('#trick').value;
      const count = parseInt($('#count').value,10);
      currentQs = makeQuiz(kind, count);
      renderQuiz(currentQs);
      $('#scoreText').textContent='å°šæœªäº¤å·'; $('#meter').style.width='0%';
    }

    $('#btnStart').onclick = start;
    $('#btnRestart').onclick = start;
    $('#btnSubmit').onclick = submitAll;
    $('#btnReveal').onclick = revealAll;

    // é è¨­å…ˆå‡º 10 é¡Œã€Œå°¾æ•¸ 5 çš„å¹³æ–¹ã€æ–¹ä¾¿é è¦½
    start();
  </script>
</body>
</html>
